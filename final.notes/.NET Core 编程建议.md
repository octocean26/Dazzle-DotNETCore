# .NET Core 编程建议



#### 使用HtmlEncoder.Default.Encode保护应用程序免受恶意输入

当从后端C#代码中返回前端String类型的字符串时，为了防止不安全的字符串输出，建议使用HtmlEncoder.Default.Encode()方法。

```c#
public string Say(string name, int numTimes = 1)
{
    return HtmlEncoder.Default.Encode($"Hello {name}, NumTimes is: {numTimes}");
}
```



#### 巧用Url的成员方法代替纯字符串路径

有时程序需要返回一个Url链接时，一般直接使用纯字符串方式进行返回，有一个更好的方式是使用Url的成员方法，它更加规范和灵活。例如：

```c#
string returnUrl=Url.Content("~/");
```

```c#
var callbackUrl = Url.Page(
                "/Account/ConfirmEmail",
                pageHandler: null,
                values: new { userId = user.Id, code = code },
                protocol: Request.Scheme);
```

```html
<form asp-area="Identity" asp-page="/Account/Logout" 
          asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" 
          method="post" 
          id="logoutForm" class="navbar-right">
          <p>其他内容</p>
</form>
```



#### 使用[Bind]特性防止数据过度提交

```c#
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<IActionResult> Edit(int id, [Bind("ID,Title,ReleaseDate")] Movie movie)
{
}
```

上述代码使用[Bind]特性，实现提交的数据只绑定到Movie的ID、Title、ReleaseDate三个属性。

注意：[Bind]特性并不是防止数据过度提交的最佳方案，最好使用自定义的ViewModel，即上述代码中的Movie使用自定义的ViewModel代替，该ViewModel只包含要绑定的属性。

另外，[ValidateAntiForgeryToken]特性可以用于防止跨站点请求伪造，如果表单中生成了隐藏的防伪标记，建议所有的Post处理都加入该特性，该特性生成的防伪标记必须和表单隐藏的防伪标记相匹配，才会处理提交的数据。





